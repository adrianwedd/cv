name: ğŸ”— LinkedIn Professional Integration

# ğŸ¯ **LINKEDIN PROFESSIONAL AUTOMATION PIPELINE**
# This workflow automates LinkedIn profile synchronization with comprehensive
# ethical safeguards, AI-powered optimization, and professional networking intelligence.
#
# ğŸ”„ **EXECUTION SCHEDULE**: Mon, Wed, Fri at 9 AM UTC + manual dispatch
# ğŸ“Š **FEATURES**: Bidirectional sync, AI enhancement, networking analytics
# ğŸ”’ **ETHICS**: User consent, rate limiting, audit logging, respectful automation
# ğŸ¨ **INTEGRATION**: Seamless CV enhancement pipeline connectivity

on:
  schedule:
    # Mon, Wed, Fri at 9 AM UTC (professional posting schedule)
    - cron: '0 9 * * 1,3,5'
  workflow_dispatch:
    inputs:
      sync_mode:
        description: 'ğŸ”— LinkedIn Sync Mode'
        required: false
        default: 'bidirectional'
        type: choice
        options:
          - bidirectional      # CV â†” LinkedIn full sync
          - cv-to-linkedin     # CV â†’ LinkedIn update only
          - linkedin-to-cv     # LinkedIn â†’ CV extraction only
          - analysis-only      # Professional analytics only
      dry_run:
        description: 'ğŸ§ª Dry Run (Preview Only)'
        required: false
        default: true
        type: boolean
      networking_analysis:
        description: 'ğŸ¤ AI Networking Analysis'
        required: false
        default: true
        type: boolean
      force_sync:
        description: 'ğŸ”„ Force Full Synchronization'
        required: false
        default: false
        type: boolean
  push:
    paths: 
      - 'data/base-cv.json'    # Trigger on CV data changes
      - '.github/scripts/linkedin-*.js'  # Trigger on LinkedIn component updates

env:
  LINKEDIN_SYSTEM_VERSION: "v1.0-enterprise"
  TIMEZONE: "Australia/Tasmania"
  # Professional networking configuration
  ETHICAL_FRAMEWORK: "enabled"
  AUDIT_LOGGING: "comprehensive"
  RATE_LIMIT_MS: "45000"       # 45 seconds between operations
  MAX_UPDATES_PER_SESSION: "5" # Safety limit on profile changes

# ğŸ”— **LINKEDIN INTEGRATION WORKFLOW MAP**
# Each job creates professional networking intelligence with:
# - Ethical automation with comprehensive consent verification
# - AI-powered content optimization and networking recommendations
# - Real-time dashboard updates with professional analytics
# - Complete audit trails and professional compliance

jobs:
  # DISABLED FOR BILLING - REMOVE WHEN BILLING RESOLVED
  disabled:
    if: true
    runs-on: ubuntu-latest
    steps:
      - run: echo "All workflows disabled for billing management"
  # TEMPORARILY DISABLED FOR BILLING - DO NOT RUN
  disabled-for-billing:
    if: false
    runs-on: ubuntu-latest
    steps:
      - run: echo "Workflow disabled for billing management"  # ğŸ” LINKEDIN PROFILE ANALYSIS & STRATEGY
  linkedin-intelligence:
    name: ğŸ” LinkedIn Intelligence Analysis
    runs-on: ubuntu-latest
    outputs:
      sync-strategy: ${{ steps.strategy.outputs.strategy }}
      profile-status: ${{ steps.profile.outputs.status }}
      networking-score: ${{ steps.networking.outputs.score }}
      ai-recommendations: ${{ steps.ai.outputs.recommendations }}
      session-id: ${{ steps.session.outputs.id }}
      consent-verified: ${{ steps.consent.outputs.verified }}
    steps:
      - name: ğŸš€ LinkedIn Integration Initialization
        run: |
          echo "ğŸ”— **LINKEDIN PROFESSIONAL INTEGRATION INITIATED**"
          echo "ğŸ“… $(TZ='${{ env.TIMEZONE }}' date +'%Y-%m-%d %H:%M %Z')"
          echo "ğŸ”„ Sync Mode: ${{ github.event.inputs.sync_mode || 'bidirectional' }}"
          echo "ğŸ§ª Dry Run: ${{ github.event.inputs.dry_run || 'true' }}"
          echo "ğŸ¤ Networking Analysis: ${{ github.event.inputs.networking_analysis || 'true' }}"
          echo "ğŸ“Š Version: ${{ env.LINKEDIN_SYSTEM_VERSION }}"

      - name: ğŸ“¥ Repository Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ”§ Node.js Setup
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: '.github/scripts/package-lock.json'

      - name: ğŸ“¦ Dependencies Installation
        run: |
          echo "ğŸ“¦ **Installing LinkedIn Integration Dependencies**"
          cd .github/scripts
          npm ci --production
          echo "âœ… Dependencies installed successfully"

      - name: âœ… User Consent Verification
        id: consent
        run: |
          echo "âœ… **VERIFYING USER CONSENT & ETHICAL COMPLIANCE**"
          
          # Check for LinkedIn user consent environment variable
          if [ -n "${{ secrets.LINKEDIN_USER_CONSENT }}" ] && [ "${{ secrets.LINKEDIN_USER_CONSENT }}" = "true" ]; then
            CONSENT_VERIFIED="true"
            echo "âœ… User consent verified for LinkedIn profile modifications"
          else
            CONSENT_VERIFIED="false"
            echo "âš ï¸ User consent not provided - analysis-only mode will be used"
          fi
          
          echo "verified=$CONSENT_VERIFIED" >> $GITHUB_OUTPUT
          echo "::notice title=Consent Status::User consent verified: $CONSENT_VERIFIED"

      - name: ğŸ¯ Synchronization Strategy
        id: strategy
        run: |
          SYNC_MODE="${{ github.event.inputs.sync_mode || 'bidirectional' }}"
          DRY_RUN="${{ github.event.inputs.dry_run || 'true' }}"
          FORCE_SYNC="${{ github.event.inputs.force_sync || 'false' }}"
          CONSENT="${{ steps.consent.outputs.verified }}"
          
          # Determine strategy based on inputs and consent
          if [ "$CONSENT" = "false" ]; then
            STRATEGY="analysis-only"
            echo "ğŸ” Strategy: Analysis only (no consent for modifications)"
          elif [ "$DRY_RUN" = "true" ]; then
            STRATEGY="preview"
            echo "ğŸ§ª Strategy: Preview mode (dry run)"
          elif [ "$FORCE_SYNC" = "true" ]; then
            STRATEGY="force-sync"
            echo "ğŸ”„ Strategy: Force synchronization"
          else
            STRATEGY="$SYNC_MODE"
            echo "ğŸ¯ Strategy: ${SYNC_MODE^}"
          fi
          
          echo "strategy=$STRATEGY" >> $GITHUB_OUTPUT
          echo "::notice title=Sync Strategy::Selected: $STRATEGY"

      - name: ğŸ”— LinkedIn Profile Status Check
        id: profile
        run: |
          echo "ğŸ”— **CHECKING LINKEDIN PROFILE STATUS**"
          cd .github/scripts
          
          # Test LinkedIn connectivity and profile access
          if [ -n "${{ secrets.LINKEDIN_SESSION_COOKIES }}" ]; then
            # Test profile extraction
            if timeout 120 node linkedin-playwright-extractor.js test; then
              PROFILE_STATUS="accessible"
              echo "âœ… LinkedIn profile accessible and ready for sync"
            else
              PROFILE_STATUS="limited"
              echo "âš ï¸ LinkedIn profile access limited - using cached data"
            fi
          else
            PROFILE_STATUS="no-auth"
            echo "âš ï¸ No LinkedIn authentication - analysis mode only"
          fi
          
          echo "status=$PROFILE_STATUS" >> $GITHUB_OUTPUT
          echo "::notice title=Profile Status::$PROFILE_STATUS"
        env:
          LINKEDIN_SESSION_COOKIES: ${{ secrets.LINKEDIN_SESSION_COOKIES }}
          LINKEDIN_USER_CONSENT: ${{ secrets.LINKEDIN_USER_CONSENT }}

      - name: ğŸ¤ Professional Networking Analysis
        id: networking
        run: |
          echo "ğŸ¤ **ANALYZING PROFESSIONAL NETWORKING METRICS**"
          
          # Calculate networking effectiveness score
          if [ -f "../data/activity-summary.json" ]; then
            # Extract GitHub activity metrics for networking context
            REPOS=$(jq -r '.summary.total_repositories // 0' ../data/activity-summary.json)
            LANGUAGES=$(jq -r '.summary.top_languages | length' ../data/activity-summary.json)
            RECENT_ACTIVITY=$(jq -r '.summary.commits_last_30_days // 0' ../data/activity-summary.json)
            
            # Calculate professional networking score using Node.js
            NETWORKING_SCORE=$(node -e "
              const repos = ${REPOS} || 0;
              const languages = ${LANGUAGES} || 0;
              const activity = ${RECENT_ACTIVITY} || 0;
              const score = Math.floor((repos * 0.5) + (languages * 5) + (activity * 0.1));
              console.log(Math.min(score, 100));
            ")
          else
            NETWORKING_SCORE=50
          fi
          
          echo "ğŸ¤ **Networking Analysis:**"
          echo "  â€¢ Professional Score: $NETWORKING_SCORE/100"
          echo "  â€¢ Repository Portfolio: $REPOS repositories"
          echo "  â€¢ Technology Stack: $LANGUAGES languages"
          echo "  â€¢ Recent Activity: $RECENT_ACTIVITY commits (30d)"
          
          echo "score=$NETWORKING_SCORE" >> $GITHUB_OUTPUT
          echo "::notice title=Networking Score::$NETWORKING_SCORE/100"

      - name: ğŸ¤– AI Enhancement Recommendations
        id: ai
        run: |
          echo "ğŸ¤– **GENERATING AI-POWERED RECOMMENDATIONS**"
          cd .github/scripts
          
          STRATEGY="${{ steps.strategy.outputs.strategy }}"
          NETWORKING_SCORE="${{ steps.networking.outputs.score }}"
          
          # Generate AI recommendations based on strategy and networking score
          if [ "${{ github.event.inputs.networking_analysis }}" = "true" ] && [ -n "${{ secrets.GEMINI_API_KEY }}" ]; then
            AI_RECOMMENDATIONS="enabled"
            echo "ğŸ¤– AI recommendations: Enabled with Gemini integration"
          else
            AI_RECOMMENDATIONS="disabled"
            echo "âš ï¸ AI recommendations: Disabled (no API key or analysis disabled)"
          fi
          
          echo "recommendations=$AI_RECOMMENDATIONS" >> $GITHUB_OUTPUT
          echo "::notice title=AI Recommendations::$AI_RECOMMENDATIONS"

      - name: ğŸ”¢ Session Tracking
        id: session
        run: |
          SESSION_ID="linkedin-$(date +%Y%m%d-%H%M%S)-${GITHUB_RUN_NUMBER}"
          echo "ğŸ”¢ LinkedIn Session ID: $SESSION_ID"
          echo "id=$SESSION_ID" >> $GITHUB_OUTPUT

      - name: ğŸ“ Intelligence Summary
        if: always()
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ğŸ”— LinkedIn Intelligence Analysis Results
          
          | Analysis | Result |
          |----------|--------|
          | ğŸ¯ Sync Strategy | ${{ steps.strategy.outputs.strategy }} |
          | ğŸ”— Profile Status | ${{ steps.profile.outputs.status }} |
          | âœ… User Consent | ${{ steps.consent.outputs.verified }} |
          | ğŸ¤ Networking Score | ${{ steps.networking.outputs.score }}/100 |
          | ğŸ¤– AI Recommendations | ${{ steps.ai.outputs.recommendations }} |
          | ğŸ”¢ Session ID | `${{ steps.session.outputs.id }}` |
          EOF

  # ğŸ”„ LINKEDIN PROFILE SYNCHRONIZATION
  linkedin-synchronization:
    name: ğŸ”„ LinkedIn Profile Sync
    runs-on: ubuntu-latest
    needs: linkedin-intelligence
    if: needs.linkedin-intelligence.outputs.profile-status != 'no-auth'
    outputs:
      sync-status: ${{ steps.sync.outputs.status }}
      changes-detected: ${{ steps.sync.outputs.changes }}
      operations-count: ${{ steps.sync.outputs.operations }}
      backup-created: ${{ steps.backup.outputs.status }}
    environment:
      name: linkedin-sync
      url: https://linkedin.com/in/${{ secrets.LINKEDIN_PROFILE_USERNAME }}
    steps:
      - name: ğŸ“¥ Repository Checkout
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js Setup
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: '.github/scripts/package-lock.json'

      - name: ğŸ“¦ Dependencies Installation
        run: |
          cd .github/scripts
          npm ci --production

      - name: ğŸ’¾ Profile Backup Creation
        id: backup
        run: |
          echo "ğŸ’¾ **CREATING LINKEDIN PROFILE BACKUP**"
          cd .github/scripts
          
          # Create backup of current LinkedIn profile data
          if timeout 180 node linkedin-playwright-extractor.js extract "${{ secrets.LINKEDIN_PROFILE_URL }}" --backup; then
            BACKUP_STATUS="created"
            echo "âœ… LinkedIn profile backup created successfully"
          else
            BACKUP_STATUS="failed"
            echo "âš ï¸ Profile backup failed - proceeding with caution"
          fi
          
          echo "status=$BACKUP_STATUS" >> $GITHUB_OUTPUT
          echo "::notice title=Backup Status::$BACKUP_STATUS"
        env:
          LINKEDIN_SESSION_COOKIES: ${{ secrets.LINKEDIN_SESSION_COOKIES }}
          LINKEDIN_USER_CONSENT: ${{ secrets.LINKEDIN_USER_CONSENT }}

      - name: ğŸ”„ Profile Synchronization Execution
        id: sync
        run: |
          echo "ğŸ”„ **EXECUTING LINKEDIN PROFILE SYNCHRONIZATION**"
          cd .github/scripts
          
          STRATEGY="${{ needs.linkedin-intelligence.outputs.sync-strategy }}"
          DRY_RUN="${{ github.event.inputs.dry_run || 'true' }}"
          
          # Build synchronization command
          SYNC_COMMAND="node linkedin-profile-synchronizer.js sync ${{ secrets.LINKEDIN_PROFILE_URL }}"
          
          if [ "$DRY_RUN" = "true" ]; then
            SYNC_COMMAND="$SYNC_COMMAND --dry-run"
            echo "ğŸ§ª Executing dry run synchronization"
          else
            echo "ğŸ”„ Executing live synchronization"
          fi
          
          # Add strategy-specific flags
          case "$STRATEGY" in
            "cv-to-linkedin")
              SYNC_COMMAND="$SYNC_COMMAND --direction=cv-to-linkedin"
              ;;
            "linkedin-to-cv")
              SYNC_COMMAND="$SYNC_COMMAND --direction=linkedin-to-cv"
              ;;
            "analysis-only")
              SYNC_COMMAND="$SYNC_COMMAND --analysis-only"
              ;;
            "force-sync")
              SYNC_COMMAND="$SYNC_COMMAND --force"
              ;;
          esac
          
          # Execute synchronization with timeout
          START_TIME=$(date +%s)
          
          if timeout 600 $SYNC_COMMAND 2>&1 | tee sync.log; then
            SYNC_STATUS="success"
            echo "âœ… LinkedIn synchronization completed successfully"
          else
            EXIT_CODE=$?
            if [ $EXIT_CODE -eq 124 ]; then
              SYNC_STATUS="timeout"
              echo "âš ï¸ Synchronization timed out (10 minutes)"
            else
              SYNC_STATUS="partial"
              echo "âš ï¸ Synchronization completed with issues (exit code: $EXIT_CODE)"
            fi
          fi
          
          END_TIME=$(date +%s)
          DURATION=$((END_TIME - START_TIME))
          
          # Extract synchronization metrics
          CHANGES_DETECTED=$(grep -c "change detected" sync.log 2>/dev/null || echo "0")
          OPERATIONS_COUNT=$(grep -c "operation:" sync.log 2>/dev/null || echo "0")
          
          echo "ğŸ“Š **Synchronization Results:**"
          echo "  â€¢ Status: $SYNC_STATUS"
          echo "  â€¢ Duration: ${DURATION}s"
          echo "  â€¢ Changes detected: $CHANGES_DETECTED"
          echo "  â€¢ Operations performed: $OPERATIONS_COUNT"
          
          echo "status=$SYNC_STATUS" >> $GITHUB_OUTPUT
          echo "changes=$CHANGES_DETECTED" >> $GITHUB_OUTPUT
          echo "operations=$OPERATIONS_COUNT" >> $GITHUB_OUTPUT
          echo "duration=$DURATION" >> $GITHUB_OUTPUT
          echo "::notice title=Sync Status::$SYNC_STATUS - $CHANGES_DETECTED changes, $OPERATIONS_COUNT operations, ${DURATION}s"
        env:
          LINKEDIN_SESSION_COOKIES: ${{ secrets.LINKEDIN_SESSION_COOKIES }}
          LINKEDIN_USER_CONSENT: ${{ secrets.LINKEDIN_USER_CONSENT }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ğŸ¤– AI NETWORKING INTELLIGENCE
  ai-networking-analysis:
    name: ğŸ¤– AI Networking Intelligence
    runs-on: ubuntu-latest
    needs: [linkedin-intelligence, linkedin-synchronization]
    if: needs.linkedin-intelligence.outputs.ai-recommendations == 'enabled'
    outputs:
      analysis-status: ${{ steps.analysis.outputs.status }}
      recommendations-generated: ${{ steps.analysis.outputs.recommendations }}
      networking-insights: ${{ steps.analysis.outputs.insights }}
    environment:
      name: ai-networking
      url: https://console.cloud.google.com/ai/generative
    steps:
      - name: ğŸ“¥ Repository Checkout
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js Setup
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: '.github/scripts/package-lock.json'

      - name: ğŸ“¦ Dependencies Installation
        run: |
          cd .github/scripts
          npm ci --production

      - name: ğŸ¤– AI Networking Analysis Execution
        id: analysis
        run: |
          echo "ğŸ¤– **EXECUTING AI-POWERED NETWORKING ANALYSIS**"
          cd .github/scripts
          
          # Execute AI networking agent with comprehensive analysis
          START_TIME=$(date +%s)
          
          if timeout 300 node ai-networking-agent-simple.js analyze "${{ secrets.LINKEDIN_PROFILE_URL }}" --comprehensive; then
            ANALYSIS_STATUS="success"
            echo "âœ… AI networking analysis completed successfully"
          else
            EXIT_CODE=$?
            if [ $EXIT_CODE -eq 124 ]; then
              ANALYSIS_STATUS="timeout"
              echo "âš ï¸ AI analysis timed out (5 minutes)"
            else
              ANALYSIS_STATUS="partial"
              echo "âš ï¸ AI analysis completed with issues (exit code: $EXIT_CODE)"
            fi
          fi
          
          END_TIME=$(date +%s)
          DURATION=$((END_TIME - START_TIME))
          
          # Check for generated recommendations and insights
          if [ -f "../data/networking-recommendations.json" ]; then
            RECOMMENDATIONS_COUNT=$(jq -r '.recommendations | length' ../data/networking-recommendations.json)
            INSIGHTS_COUNT=$(jq -r '.insights | length' ../data/networking-recommendations.json)
          else
            RECOMMENDATIONS_COUNT=0
            INSIGHTS_COUNT=0
          fi
          
          echo "ğŸ¤– **AI Analysis Results:**"
          echo "  â€¢ Status: $ANALYSIS_STATUS"
          echo "  â€¢ Duration: ${DURATION}s"
          echo "  â€¢ Recommendations: $RECOMMENDATIONS_COUNT"
          echo "  â€¢ Insights: $INSIGHTS_COUNT"
          
          echo "status=$ANALYSIS_STATUS" >> $GITHUB_OUTPUT
          echo "recommendations=$RECOMMENDATIONS_COUNT" >> $GITHUB_OUTPUT
          echo "insights=$INSIGHTS_COUNT" >> $GITHUB_OUTPUT
          echo "duration=$DURATION" >> $GITHUB_OUTPUT
          echo "::notice title=AI Analysis::$ANALYSIS_STATUS - $RECOMMENDATIONS_COUNT recommendations, $INSIGHTS_COUNT insights, ${DURATION}s"
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          LINKEDIN_SESSION_COOKIES: ${{ secrets.LINKEDIN_SESSION_COOKIES }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  # ğŸ“Š NETWORKING DASHBOARD UPDATE
  dashboard-update:
    name: ğŸ“Š Networking Dashboard Update
    runs-on: ubuntu-latest
    needs: [linkedin-intelligence, linkedin-synchronization, ai-networking-analysis]
    if: always() && needs.linkedin-intelligence.result == 'success'
    outputs:
      dashboard-status: ${{ steps.dashboard.outputs.status }}
      analytics-updated: ${{ steps.dashboard.outputs.analytics }}
    environment:
      name: networking-dashboard
      url: https://adrianwedd.com/networking-dashboard.html
    steps:
      - name: ğŸ“¥ Repository Checkout
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js Setup
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: '.github/scripts/package-lock.json'

      - name: ğŸ“¦ Dependencies Installation
        run: |
          cd .github/scripts
          npm ci --production

      - name: ğŸ“Š Professional Dashboard Update
        id: dashboard
        run: |
          echo "ğŸ“Š **UPDATING PROFESSIONAL NETWORKING DASHBOARD**"
          
          # Update networking dashboard with latest LinkedIn and AI data
          SYNC_STATUS="${{ needs.linkedin-synchronization.outputs.sync-status || 'skipped' }}"
          AI_STATUS="${{ needs.ai-networking-analysis.outputs.analysis-status || 'skipped' }}"
          
          # Create dashboard update timestamp
          DASHBOARD_UPDATE=$(date -u +'%Y-%m-%dT%H:%M:%SZ')
          
          # Update dashboard data with LinkedIn integration results
          cat > networking-dashboard-data.json << EOF
          {
            "last_updated": "$DASHBOARD_UPDATE",
            "linkedin_integration": {
              "sync_status": "$SYNC_STATUS",
              "changes_detected": "${{ needs.linkedin-synchronization.outputs.changes-detected || 0 }}",
              "operations_count": "${{ needs.linkedin-synchronization.outputs.operations-count || 0 }}",
              "backup_created": "${{ needs.linkedin-synchronization.outputs.backup-created || 'false' }}"
            },
            "ai_networking": {
              "analysis_status": "$AI_STATUS",
              "recommendations_generated": "${{ needs.ai-networking-analysis.outputs.recommendations-generated || 0 }}",
              "networking_insights": "${{ needs.ai-networking-analysis.outputs.networking-insights || 0 }}"
            },
            "session_metadata": {
              "session_id": "${{ needs.linkedin-intelligence.outputs.session-id }}",
              "networking_score": "${{ needs.linkedin-intelligence.outputs.networking-score }}",
              "sync_strategy": "${{ needs.linkedin-intelligence.outputs.sync-strategy }}",
              "consent_verified": "${{ needs.linkedin-intelligence.outputs.consent-verified }}"
            }
          }
          EOF
          
          if [ -f "networking-dashboard-data.json" ]; then
            DASHBOARD_STATUS="updated"
            ANALYTICS_UPDATED="true"
            echo "âœ… Professional dashboard updated successfully"
          else
            DASHBOARD_STATUS="failed"
            ANALYTICS_UPDATED="false"
            echo "âš ï¸ Dashboard update failed"
          fi
          
          echo "status=$DASHBOARD_STATUS" >> $GITHUB_OUTPUT
          echo "analytics=$ANALYTICS_UPDATED" >> $GITHUB_OUTPUT
          echo "::notice title=Dashboard Update::$DASHBOARD_STATUS (analytics: $ANALYTICS_UPDATED)"

  # ğŸ“ˆ PROFESSIONAL ANALYTICS & REPORTING
  professional-reporting:
    name: ğŸ“ˆ Professional Analytics
    runs-on: ubuntu-latest
    needs: [linkedin-intelligence, linkedin-synchronization, ai-networking-analysis, dashboard-update]
    if: always()
    environment:
      name: professional-analytics
      url: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
    steps:
      - name: ğŸ“¥ Repository Checkout
        uses: actions/checkout@v4

      - name: ğŸ”§ Node.js Setup
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          cache-dependency-path: '.github/scripts/package-lock.json'

      - name: ğŸ“¦ Dependencies Installation
        run: |
          cd .github/scripts
          npm ci --production

      - name: ğŸ“Š Professional Analytics Recording
        run: |
          echo "ğŸ“Š **RECORDING LINKEDIN INTEGRATION ANALYTICS**"
          cd .github/scripts
          
          # Record LinkedIn session analytics
          if command -v node >/dev/null; then
            node usage-monitor.js record-linkedin-session \
              --session-id="${{ needs.linkedin-intelligence.outputs.session-id }}" \
              --sync-mode="${{ github.event.inputs.sync_mode || 'bidirectional' }}" \
              --strategy="${{ needs.linkedin-intelligence.outputs.sync-strategy }}" \
              --networking-score="${{ needs.linkedin-intelligence.outputs.networking-score }}" \
              --sync-status="${{ needs.linkedin-synchronization.outputs.sync-status || 'skipped' }}" \
              --changes-detected="${{ needs.linkedin-synchronization.outputs.changes-detected || 0 }}" \
              --ai-analysis="${{ needs.ai-networking-analysis.outputs.analysis-status || 'skipped' }}" \
              --recommendations="${{ needs.ai-networking-analysis.outputs.recommendations-generated || 0 }}" \
              --consent-verified="${{ needs.linkedin-intelligence.outputs.consent-verified }}" || {
              echo "âš ï¸ LinkedIn analytics recording failed, creating manual entry"
            }
          else
            echo "âš ï¸ Node.js not available for analytics recording"
          fi

      - name: ğŸ“ˆ Integration Performance Analysis
        run: |
          echo "ğŸ“ˆ **LINKEDIN INTEGRATION PERFORMANCE ANALYSIS**"
          
          # Calculate LinkedIn integration metrics
          TOTAL_JOBS=5
          SUCCESSFUL_JOBS=$(echo "${{ needs.linkedin-intelligence.result == 'success' }} + \
                                  ${{ (needs.linkedin-synchronization.result == 'success') || (needs.linkedin-synchronization.result == 'skipped') }} + \
                                  ${{ (needs.ai-networking-analysis.result == 'success') || (needs.ai-networking-analysis.result == 'skipped') }} + \
                                  ${{ needs.dashboard-update.result == 'success' }}" | bc)
          SUCCESS_RATE=$(echo "scale=1; $SUCCESSFUL_JOBS / $TOTAL_JOBS * 100" | bc)
          
          echo "ğŸ”— **LinkedIn Integration Performance:**"
          echo "  â€¢ Success rate: $SUCCESS_RATE% ($SUCCESSFUL_JOBS/$TOTAL_JOBS jobs)"
          echo "  â€¢ Session ID: ${{ needs.linkedin-intelligence.outputs.session-id }}"
          echo "  â€¢ Sync strategy: ${{ needs.linkedin-intelligence.outputs.sync-strategy }}"
          echo "  â€¢ Networking score: ${{ needs.linkedin-intelligence.outputs.networking-score }}/100"
          echo "  â€¢ Profile status: ${{ needs.linkedin-intelligence.outputs.profile-status }}"
          echo "  â€¢ User consent: ${{ needs.linkedin-intelligence.outputs.consent-verified }}"
          echo "  â€¢ Changes detected: ${{ needs.linkedin-synchronization.outputs.changes-detected || 0 }}"
          echo "  â€¢ AI recommendations: ${{ needs.ai-networking-analysis.outputs.recommendations-generated || 0 }}"
          echo "  â€¢ Dashboard updated: ${{ needs.dashboard-update.outputs.dashboard-status }}"
          
          echo "::notice title=LinkedIn Integration Success::$SUCCESS_RATE% success rate"

      - name: ğŸš€ LinkedIn Integration Summary
        run: |
          echo "ğŸ”— **LINKEDIN PROFESSIONAL INTEGRATION COMPLETED**"
          echo ""
          echo "ğŸ“Š **Final Results:**"
          echo "  ğŸ¯ Strategy: ${{ needs.linkedin-intelligence.outputs.sync-strategy }}"
          echo "  ğŸ”— Profile: ${{ needs.linkedin-intelligence.outputs.profile-status }}"
          echo "  âœ… Consent: ${{ needs.linkedin-intelligence.outputs.consent-verified }}"
          echo "  ğŸ”„ Sync: ${{ needs.linkedin-synchronization.outputs.sync-status || 'skipped' }}"
          echo "  ğŸ¤– AI Analysis: ${{ needs.ai-networking-analysis.outputs.analysis-status || 'skipped' }}"
          echo "  ğŸ“Š Dashboard: ${{ needs.dashboard-update.outputs.dashboard-status }}"
          echo "  ğŸ¤ Networking Score: ${{ needs.linkedin-intelligence.outputs.networking-score }}/100"
          echo ""
          echo "âœ… **LinkedIn Integration Successfully Completed!**"
          
          # Write comprehensive summary to GitHub Actions UI
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          # ğŸ”— LinkedIn Professional Integration Summary
          
          ## ğŸ“Š Integration Metrics
          | Metric | Value |
          |--------|-------|
          | ğŸ¯ **Sync Strategy** | ${{ needs.linkedin-intelligence.outputs.sync-strategy }} |
          | ğŸ”— **Profile Status** | ${{ needs.linkedin-intelligence.outputs.profile-status }} |
          | âœ… **User Consent** | ${{ needs.linkedin-intelligence.outputs.consent-verified }} |
          | ğŸ¤ **Networking Score** | ${{ needs.linkedin-intelligence.outputs.networking-score }}/100 |
          | ğŸ”„ **Synchronization** | ${{ needs.linkedin-synchronization.outputs.sync-status || 'skipped' }} |
          | ğŸ“ **Changes Detected** | ${{ needs.linkedin-synchronization.outputs.changes-detected || 0 }} |
          | âš™ï¸ **Operations** | ${{ needs.linkedin-synchronization.outputs.operations-count || 0 }} |
          | ğŸ’¾ **Backup Created** | ${{ needs.linkedin-synchronization.outputs.backup-created || 'false' }} |
          | ğŸ¤– **AI Analysis** | ${{ needs.ai-networking-analysis.outputs.analysis-status || 'skipped' }} |
          | ğŸ’¡ **Recommendations** | ${{ needs.ai-networking-analysis.outputs.recommendations-generated || 0 }} |
          | ğŸ“Š **Dashboard Status** | ${{ needs.dashboard-update.outputs.dashboard-status }} |
          
          ## ğŸ”— Professional Links
          - ğŸ”— [LinkedIn Profile](https://linkedin.com/in/${{ secrets.LINKEDIN_PROFILE_USERNAME }})
          - ğŸ“Š [Networking Dashboard](https://adrianwedd.com/networking-dashboard.html)
          - ğŸ¤– [AI Insights](https://adrianwedd.com/networking-dashboard.html#ai-insights)
          
          ## ğŸš€ Integration Results
          - **Session ID**: `${{ needs.linkedin-intelligence.outputs.session-id }}`
          - **Sync Mode**: ${{ github.event.inputs.sync_mode || 'bidirectional' }}
          - **Dry Run**: ${{ github.event.inputs.dry_run || 'true' }}
          
          ---
          > ğŸ¤– Generated with [Claude Code](https://claude.ai/code)
          EOF

      - name: ğŸ’¾ Commit LinkedIn Integration Data
        run: |
          echo "ğŸ’¾ **COMMITTING LINKEDIN INTEGRATION UPDATES**"
          
          git config --local user.email "linkedin-integration@adrianwedd.com"
          git config --local user.name "LinkedIn Integration Bot"
          
          # Check for changes
          if git diff --quiet && git diff --staged --quiet; then
            echo "â„¹ï¸ No LinkedIn integration changes to commit"
          else
            git add data/ networking-dashboard-data.json
            git commit -m "ğŸ”— LinkedIn Integration: Session ${{ needs.linkedin-intelligence.outputs.session-id }}

            ğŸ¯ Strategy: ${{ needs.linkedin-intelligence.outputs.sync-strategy }}
            ğŸ¤ Networking Score: ${{ needs.linkedin-intelligence.outputs.networking-score }}/100
            ğŸ”„ Sync Status: ${{ needs.linkedin-synchronization.outputs.sync-status || 'skipped' }}
            ğŸ“ Changes: ${{ needs.linkedin-synchronization.outputs.changes-detected || 0 }}
            ğŸ¤– AI Recommendations: ${{ needs.ai-networking-analysis.outputs.recommendations-generated || 0 }}
            ğŸ“Š Dashboard: ${{ needs.dashboard-update.outputs.dashboard-status }}

            ğŸ¤– Generated with [Claude Code](https://claude.ai/code)

            Co-Authored-By: Claude <noreply@anthropic.com>" || {
              echo "âš ï¸ Commit failed, possibly no changes or conflict"
            }
            
            git push || {
              echo "âš ï¸ Push failed, possibly due to concurrent modifications"
            }
          fi