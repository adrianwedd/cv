<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Export System Test</title>
    <link rel="stylesheet" href="assets/styles.css">
    <link rel="stylesheet" href="assets/cv-export-styles.css">
    <style>
        body {
            padding: 20px;
            font-family: Inter, Arial, sans-serif;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-button {
            background: var(--color-primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background: var(--color-primary-dark);
        }
    </style>
<link rel="stylesheet" href="assets/pwa-mobile.css">

<!-- Touch Optimization -->
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#2563eb">

<link rel="dns-prefetch" href="//cdn.jsdelivr.net">
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">

<style>
/* Critical CSS for above-the-fold content */
.dashboard-header {
  background: var(--color-primary, #2563eb);
  color: white;
  padding: 1rem;
  position: sticky;
  top: 0;
  z-index: 100;
}

.loading-spinner {
  display: inline-block;
  width: 2rem;
  height: 2rem;
  border: 3px solid rgba(255,255,255,.3);
  border-radius: 50%;
  border-top-color: #fff;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}
</style>
</head>
<body>

<a href="#main-content" class="skip-link">Skip to main content</a>
<a href="#navigation" class="skip-link">Skip to navigation</a>

<style>
.skip-link {
  position: absolute;
  top: -40px;
  left: 6px;
  background: #000;
  color: #fff;
  padding: 8px;
  text-decoration: none;
  z-index: 1000;
  border-radius: 0 0 4px 4px;
}

.skip-link:focus {
  top: 0;
}
</style>
    <div class="test-container">
        <h1>üöÄ CV Export System Test</h1>
        <p>Test the comprehensive multi-format CV export system with ATS optimization.</p>
        
        <div class="test-controls">
            <button class="test-button" onclick="testExportSystem()">
                Initialize Export System
            </button>
            <button class="test-button" onclick="showExportModal()">
                Show Export Modal
            </button>
            <button class="test-button" onclick="testATSAnalyzer()">
                Test ATS Analyzer
            </button>
            <button class="test-button" onclick="testTemplateEngine()">
                Test Template Engine
            </button>
        </div>
        
        <div id="test-results" style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3>Test Results:</h3>
            <div id="results-content">Ready to test...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/ats-analyzer.js"></script>
    <script src="assets/cv-template-engine.js"></script>
    <script src="assets/cv-export-system.js"></script>
    
    <script>
        // Test data
        const testCVData = {
            metadata: {
                version: "2.0.0",
                last_updated: new Date().toISOString(),
                data_source: "Test Data"
            },
            personal_info: {
                name: "Test User",
                title: "Software Engineer",
                location: "Test City, Country",
                email: "test@example.com",
                website: "https://test.example.com",
                github: "https://github.com/testuser",
                linkedin: "https://linkedin.com/in/testuser"
            },
            professional_summary: "Experienced software engineer with expertise in Python, JavaScript, and machine learning. Strong background in building scalable applications and leading development teams.",
            experience: [
                {
                    position: "Senior Software Engineer",
                    company: "Tech Company",
                    period: "2020 - Present",
                    description: "Lead development of machine learning applications using Python and TensorFlow.",
                    achievements: [
                        "Improved system performance by 40% through optimization",
                        "Led team of 5 developers on critical project delivery"
                    ],
                    technologies: ["Python", "TensorFlow", "JavaScript", "React", "AWS"]
                }
            ],
            skills: [
                { name: "Python", category: "Programming Languages", level: 95, proficiency: "Expert", experience_years: 8 },
                { name: "JavaScript", category: "Programming Languages", level: 90, proficiency: "Expert", experience_years: 6 },
                { name: "Machine Learning", category: "AI & Data Science", level: 85, proficiency: "Advanced", experience_years: 5 },
                { name: "React", category: "Frontend", level: 80, proficiency: "Advanced", experience_years: 4 }
            ],
            projects: [
                {
                    name: "AI Classification System",
                    description: "Built machine learning system for document classification using deep learning techniques.",
                    technologies: ["Python", "TensorFlow", "Docker", "AWS"],
                    metrics: [
                        { label: "Accuracy", value: "95%" },
                        { label: "Processing Speed", value: "1000 docs/min" }
                    ]
                }
            ],
            education: [
                {
                    degree: "Bachelor of Computer Science",
                    institution: "Test University",
                    period: "2016 - 2020",
                    key_areas: ["Software Engineering", "Machine Learning", "Database Systems"]
                }
            ],
            achievements: [
                {
                    icon: "üèÜ",
                    title: "Technical Innovation Award",
                    description: "Recognized for developing innovative AI solution that increased efficiency by 50%",
                    date: "2023"
                }
            ]
        };

        let exportSystem = null;

        function log(message) {
            const resultsContent = document.getElementById('results-content');
            const timestamp = new Date().toLocaleTimeString();
            resultsContent.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            console.log(message);
        }

        function testExportSystem() {
            try {
                log('üöÄ Initializing CV Export System...');
                
                // Create export system with test data
                exportSystem = new CVExportSystem();
                exportSystem.cvData = testCVData;
                
                log('‚úÖ Export System initialized successfully');
                log(`üìä Loaded CV data for: ${testCVData.personal_info.name}`);
                
            } catch (error) {
                log(`‚ùå Export System initialization failed: ${error.message}`);
            }
        }

        function showExportModal() {
            if (!exportSystem) {
                log('‚ö†Ô∏è Please initialize Export System first');
                return;
            }
            
            try {
                log('üìã Opening export modal...');
                exportSystem.showExportModal();
                log('‚úÖ Export modal opened successfully');
            } catch (error) {
                log(`‚ùå Failed to open export modal: ${error.message}`);
            }
        }

        function testATSAnalyzer() {
            try {
                log('ü§ñ Testing ATS Analyzer...');
                
                const analyzer = new ATSAnalyzer();
                const analysis = analyzer.analyzeCV(testCVData, 'ats-text');
                
                log(`‚úÖ ATS Analysis completed`);
                log(`üìä Overall Score: ${analysis.overall_score}/100`);
                log(`üéØ Keywords Found: ${analysis.keyword_analysis.by_category ? Object.values(analysis.keyword_analysis.by_category).reduce((sum, cat) => sum + cat.found.length, 0) : 'N/A'}`);
                log(`üìã Sections Score: ${analysis.category_scores.section_structure?.score || 'N/A'}/100`);
                
            } catch (error) {
                log(`‚ùå ATS Analyzer test failed: ${error.message}`);
            }
        }

        function testTemplateEngine() {
            try {
                log('üõ†Ô∏è Testing Template Engine...');
                
                const engine = new CVTemplateEngine(testCVData);
                
                // Test different formats
                const atsText = engine.generateCV('ats-text');
                log(`‚úÖ ATS Text generated (${atsText.length} characters)`);
                
                const htmlContent = engine.generateCV('html');
                log(`‚úÖ HTML generated (${htmlContent.length} characters)`);
                
                const jsonContent = engine.generateCV('json');
                log(`‚úÖ JSON generated (${jsonContent.length} characters)`);
                
                const latexContent = engine.generateCV('latex');
                log(`‚úÖ LaTeX generated (${latexContent.length} characters)`);
                
            } catch (error) {
                log(`‚ùå Template Engine test failed: ${error.message}`);
            }
        }

        // Auto-initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('üìÑ Test page loaded successfully');
            log('üéØ Click buttons above to test different components');
            
            // Auto-initialize export system
            setTimeout(() => {
                testExportSystem();
            }, 1000);
        });
    </script>

<div id="loading-overlay" class="loading-overlay" style="display: none;">
  <div class="loading-spinner"></div>
  <p>Loading dashboard...</p>
</div>

<script>
function showLoading() {
  document.getElementById('loading-overlay').style.display = 'flex';
}

function hideLoading() {
  document.getElementById('loading-overlay').style.display = 'none';
}

// Show loading on page load
document.addEventListener('DOMContentLoaded', hideLoading);
window.addEventListener('beforeunload', showLoading);
</script>

<script>
// Offline/online detection
function updateConnectionStatus() {
  const isOnline = navigator.onLine;
  const indicator = document.getElementById('connection-indicator') || createConnectionIndicator();
  
  if (isOnline) {
    indicator.textContent = 'üåê Online';
    indicator.className = 'connection-indicator online';
  } else {
    indicator.textContent = 'üì¥ Offline';
    indicator.className = 'connection-indicator offline';
  }
}

function createConnectionIndicator() {
  const indicator = document.createElement('div');
  indicator.id = 'connection-indicator';
  indicator.style.cssText = `
    position: fixed;
    bottom: 20px;
    left: 20px;
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    z-index: 1000;
    transition: all 0.3s ease;
  `;
  document.body.appendChild(indicator);
  return indicator;
}

window.addEventListener('online', updateConnectionStatus);
window.addEventListener('offline', updateConnectionStatus);
document.addEventListener('DOMContentLoaded', updateConnectionStatus);
</script>

<main role="main" id="main-content" aria-label="Dashboard content">
  <!-- Main dashboard content -->
</main>

<nav role="navigation" id="navigation" aria-label="Dashboard navigation">
  <!-- Navigation content -->
</nav>

<script>
// Enhanced focus management
document.addEventListener('keydown', (e) => {
  // Trap focus in modal dialogs
  if (e.key === 'Tab') {
    const activeModal = document.querySelector('.modal[aria-hidden="false"]');
    if (activeModal) {
      trapFocus(e, activeModal);
    }
  }
  
  // Keyboard navigation
  if (e.key === 'Escape') {
    closeAllModals();
  }
});

function trapFocus(e, container) {
  const focusableElements = container.querySelectorAll(
    'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
  );
  
  const firstElement = focusableElements[0];
  const lastElement = focusableElements[focusableElements.length - 1];
  
  if (e.shiftKey && document.activeElement === firstElement) {
    lastElement.focus();
    e.preventDefault();
  } else if (!e.shiftKey && document.activeElement === lastElement) {
    firstElement.focus();
    e.preventDefault();
  }
}

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  if (e.altKey) {
    switch(e.key) {
      case 'h':
        document.querySelector('h1').focus();
        break;
      case 'm':
        document.querySelector('main').focus();
        break;
      case 'n':
        document.querySelector('nav').focus();
        break;
    }
  }
});
</script>
</body>
</html>