# Data Models

This section describes the JSON data models used throughout the AI-enhanced CV system. These files serve as the central data store and communication medium between different components of the pipeline.

## Overview

The system relies on a set of structured JSON files, primarily located in the `data/` directory. These files store static CV information, dynamic GitHub activity metrics, AI-generated content, and workflow usage analytics. Understanding their structure is crucial for comprehending the system's data flow and for making modifications or extensions.

## Core Data Files

### 1. `base-cv.json`

This file contains the foundational, static information about the CV. It's the primary source for personal details, experience, projects, skills, and achievements that are not dynamically generated from GitHub activity or AI.

```json
{
  "personal_info": {
    "name": "string",
    "title": "string",
    "location": "string",
    "github": "url",
    "linkedin": "url",
    "email": "string"
  },
  "professional_summary": "string",
  "experience": [
    {
      "position": "string",
      "company": "string",
      "period": "string",
      "description": "string",
      "achievements": ["string"],
      "technologies": ["string"]
    }
  ],
  "projects": [
    {
      "name": "string",
      "description": "string",
      "technologies": ["string"],
      "github": "url",
      "demo": "url",
      "metrics": [
        { "value": "string", "label": "string" }
      ]
    }
  ],
  "skills": [
    {
      "name": "string",
      "category": "string",
      "level": "number" (0-100)
    }
  ],
  "achievements": [
    {
      "icon": "string" (emoji),
      "title": "string",
      "description": "string",
      "date": "string",
      "link": "url"
    }
  ]
}
```

### 2. `activity-summary.json`

This file stores the summarized GitHub activity metrics generated by the `activity-analyzer.js` script. It provides verified GitHub data that replaces placeholder metrics in the CV generation process. **All metrics in this file are sourced from real GitHub API data and validated for integrity.**

```json
{
  "last_updated": "datetime" (ISO 8601),
  "tracker_version": "string",
  "analysis_depth": "string",
  "lookback_period_days": "number",
  "summary": {
    "total_commits": "number",
    "active_days": "number",
    "net_lines_contributed": "number",
    "tracking_status": "string",
    "last_commit_date": "datetime"
  },
  "professional_metrics": {
    "scores": {
      "activity_score": "number",
      "impact_score": "number",
      "diversity_score": "number",
      "collaboration_score": "number",
      "overall_professional_score": "number"
    },
    "raw_metrics": {
      "total_repositories": "number",
      "total_stars": "number",
      "total_forks": "number",
      "unique_languages": "number",
      "recently_active_repos": "number",
      "followers": "number",
      "account_age_years": "number"
    },
    "growth_indicators": {
      "development_velocity": "number",
      "community_engagement": "number",
      "technical_breadth": "number",
      "collaboration_index": "number"
    }
  },
  "skill_analysis": {
    "total_languages": "number",
    "expert_level": "number",
    "advanced_level": "number",
    "intermediate_level": "number",
    "top_3_skills": ["string"]
  },
  "data_files": {
    "latest_activity": "string" (filename),
    "latest_metrics": "string" (filename),
    "latest_trends": "string" (filename)
  },
  "cv_integration": {
    "ready_for_enhancement": "boolean",
    "data_freshness": "datetime",
    "next_cv_update": "string"
  }
}
```

#### Data Validation and Integrity

The `activity-summary.json` file undergoes comprehensive validation during CV generation:

- **Metric Sanitization**: All numeric values are validated and capped at reasonable limits
- **Data Type Validation**: Ensures proper data types and non-negative values
- **Freshness Tracking**: Monitors data age and warns when GitHub data is stale
- **Fallback Mechanisms**: Provides default values when GitHub data is unavailable
- **Credibility Scoring**: Calculates transparency score based on data completeness

### 3. `ai-enhancements.json`

This file stores the AI-generated and optimized content for the CV, produced by the `claude-enhancer.js` script.

```json
{
  "last_updated": "datetime" (ISO 8601),
  "creativity_level": "string",
  "ai_budget": "string",
  "activity_score": "number",
  "professional_summary": {
    "original": "string",
    "enhanced": "string",
    "enhancement_applied": "boolean",
    "improvement_notes": {
      "length_change": "number",
      "word_count_change": "number",
      "improvement_indicators": ["string"]
    }
  },
  "skills_enhancement": {
    "analysis": "string",
    "github_context": {
      "activity_score": "number",
      "top_languages": ["string"],
      "total_repos": "number"
    },
    "enhancement_applied": "boolean",
    "recommendations": ["string"]
  },
  "experience_enhancement": {
    "enhancement_suggestions": "string",
    "focus_areas": ["string"],
    "enhancement_applied": "boolean"
  },
  "project_enhancement": {
    "enhancement_strategy": "string",
    "portfolio_metrics": {
      "total_repos": "number",
      "community_impact": "number",
      "language_diversity": "number",
      "activity_score": "number"
    },
    "enhancement_applied": "boolean"
  },
  "strategic_insights": {
    "strategic_analysis": "string",
    "market_context": {
      "activity_score": "number",
      "specialization": "string",
      "location_advantage": "string",
      "innovation_focus": "string"
    },
    "insights_generated": "boolean"
  },
  "enhancement_summary": {
    "enhancement_overview": {
      "total_stages_completed": "number",
      "creativity_level": "string",
      "ai_budget_used": "string",
      "enhancement_duration_seconds": "number"
    },
    "token_analytics": {
      "input_tokens": "number",
      "output_tokens": "number",
      "cache_creation_tokens": "number",
      "cache_read_tokens": "number",
      "total_tokens": "number",
      "request_count": "number",
      "cache_hits": "number",
      "cache_efficiency_percent": "number"
    },
    "enhancement_effectiveness": {
      "professional_summary": "boolean",
      "skills_analysis": "boolean",
      "experience_optimization": "boolean",
      "project_enhancement": "boolean",
      "strategic_insights": "boolean"
    },
    "recommendations": {
      "content_freshness": "string",
      "market_alignment": "string",
      "technical_positioning": "string",
      "career_advancement": "string"
    }
  }
}
```

**Note on `professional_summary.enhanced`:** This field may contain meta-commentary or explanations from the LLM, in addition to the enhanced summary itself. Refer to [Issue #100](https://github.com/adrianwedd/cv/issues/100) for details and proposed remediation.

### 4. `cv-usage-tracking.json`

This file records the usage analytics for the CV enhancement workflows, providing insights into performance and cost over time.

```json
{
  "daily_usage": [
    {
      "timestamp": "datetime",
      "utc_timestamp": "datetime" (ISO 8601),
      "enhancement_mode": "string",
      "strategy": "string",
      "estimated_tokens": "number",
      "activity_score": "number",
      "outcome": "string" (success/failure)
    }
  ],
  "enhancement_history": [
    {
      "date": "date" (YYYY-MM-DD),
      "mode": "string",
      "activity_score": "number",
      "success": "boolean"
    }
  ],
  "performance_metrics": [
    {
      "workflow_run_id": "string",
      "job_name": "string",
      "duration_seconds": "number",
      "start_time": "datetime",
      "end_time": "datetime"
    }
  ]
}
```

**Note on `estimated_tokens` and `performance_metrics`:** The `estimated_tokens` field currently stores an estimate rather than precise token counts. The `performance_metrics` array is present in the schema but is not yet populated with actual job duration data. Refer to [Issue #15](https://github.com/adrianwedd/cv/issues/15) for details on enhancing CI performance and cost monitoring.

## Relationships

*   `base-cv.json` provides the static foundation.
*   `activity-summary.json` is dynamically generated and enriches the context for AI enhancement.
*   `ai-enhancements.json` is the output of the AI processing, containing optimized content.
*   All three (`base-cv.json`, `activity-summary.json`, `ai-enhancements.json`) are consumed by the `cv-generator.js` to produce the final CV outputs.
*   `cv-usage-tracking.json` records metadata about workflow executions, including estimated token usage and activity scores, providing a historical log of the system's operation.

## Python Data Models

This section outlines the data structures used by the Python utilities within the `src/python/` directory. These models facilitate data exchange and persistence for various functionalities.

### 1. Logging Utilities (`src/python/utils/logging_utils.py`)

While `logging_utils.py` primarily handles logging to files and console, the log entries themselves follow a structured format:

```
YYYY-MM-DD HH:MM:SS,ms - LOGGER_NAME - LEVEL - MESSAGE
```

### 2. External API Wrappers (`src/python/api_wrappers/external_apis.py`)

The data models for the external API wrappers are determined by the respective third-party APIs (Abstract API for firmographics, Intellizence for funding data). The wrappers return JSON objects directly from the API responses.

**Example (Abstract API - Company Info):**
```json
{
  "name": "string",
  "domain": "string",
  "legal_name": "string",
  "description": "string",
  "founded": "number" (year),
  "employees": "number",
  "industry": "string",
  "type": "string",
  "country": "string",
  "website_url": "url",
  "logo_url": "url"
}
```

**Example (Intellizence API - Funding Data):**
```json
[
  {
    "company_name": "string",
    "funding_round": "string",
    "amount": "number",
    "currency": "string",
    "date": "date" (YYYY-MM-DD),
    "investors": ["string"],
    "valuation": "number"
  }
]
```

### 3. Configuration Management (`src/python/config_manager/config_manager.py`)

The `ConfigManager` class handles configurations typically stored in `.ini` files. The structure is section-based, with key-value pairs.

**Example (`config.ini`):**
```ini
[API_SETTINGS]
api_key = your_api_key
base_url = https://api.example.com

[APP_SETTINGS]
debug_mode = True
max_retries = 5
```

### 4. Data Validation Utilities (`src/python/data_validation/data_validator.py`)

`data_validator.py` does not define a specific data model for persistence. Instead, its methods operate on various data types (strings, numbers, lists, dictionaries) and return boolean values indicating validation success or failure. It logs warnings for validation failures.